{% extends 'base.html.twig' %}

{% block title %}Catégorie {{ category.Name }} - {% endblock %}

{% block body %}

    <div class="example-wrapper">

        <h3 class=""><a href="{{ path("app_admin_category",{id:category.id}) }}">Catégorie {{ category.Name }}</a> > Phase : {{ phase.Name }}</h3>


{% set nbEgalite = 0 %}

{% for poule in phase.poules %}

    <h5 class="mt-4"><form class="d-inline" method="post" action="{{ path("app_admin_phase_groupe_update", {idPoule:poule.id}) }}"><input type="hidden" name="id" value="{{ poule.id }}" /><input type="text" name="pouleName" value="{{ poule.Name }}" /><input type="submit" value="modifier" /></form> <a href="{{ path("app_admin_category_phase_groupe", {groupe:poule.id,idCategory:category.id, idPhase:phase.id}) }}" class="btn btn-primary float-end py-0">voir les matchs de {{ poule.Name }}</a></h5>
    <hr >


    {% if classement[poule.Id] is defined %}

    <table class="table table-striped table-bordered">
        <tr>
            <th>#</th>
            <th>Équipe</th>
            <th>Points</th>
            <th>Diff</th>
            <th>Pour</th>
            <th>Contre</th>
            <th>Victoire</th>
            <th>Défaite</th>
            <th>Nul</th>

        </tr>
        {% for key, team in classement[poule.Id] %}

            <tr>

                <td>
                    {% if team.rangForce is defined %}
                    {{ team.rangForce }}
                    {% else %}
                    {% if team.egalite is defined %}
                        {% if classement[poule.Id][key-1] is defined and team.bonus1 == classement[poule.Id][key-1].bonus1 and ( (classement[poule.Id][key-1].but_pour - classement[poule.Id][key-1].but_contre ) == (team.but_pour - team.but_contre )) %}
                            <span class="badge bg-danger rounded">égalité</span>
                            <form class="d-inline" action="{{ path("app_admin_egalite") }}" method="post"><input type="hidden" name="idPhase" value="{{ phase.id }}"><input type="hidden" name="idCategory" value="{{ category.id }}"><input type="hidden" name="poule" value="{{ poule.Id }}"><input type="hidden" name="team" value="{{ team.id }}"><input type="text" style="width: 30px;" name="rang"><input type="submit" value="X" /></form>
                            {% set nbEgalite = nbEgalite + 1 %}

                        {% elseif classement[poule.Id][key+1] is defined and team.bonus1 == classement[poule.Id][key+1].bonus1 and ( (classement[poule.Id][key+1].but_pour - classement[poule.Id][key+1].but_contre ) == (team.but_pour - team.but_contre )) %}
                            {% set nbEgalite = nbEgalite+ 1 %}
                            <span class="badge bg-danger rounded">égalité</span>
                            <form class="d-inline" action="{{ path("app_admin_egalite") }}" method="post"><input type="hidden" name="idPhase" value="{{ phase.id }}"><input type="hidden" name="idCategory" value="{{ category.id }}"><input type="hidden" name="poule" value="{{ poule.Id }}"><input type="hidden" name="team" value="{{ team.id }}"><input type="text" style="width: 30px;" name="rang"><input type="submit" value="X" /></form>

                        {% else %}{{ team.rang }}

                        {% endif %}
                        {% else %} {{ team.rang }}
                    {% endif %}
                        {% endif %}





                </td>
                <td>{{ team.Name }}</td>
                <td>{{ team.pts }}</td>
                <td>{{ team.but_pour - team.but_contre }}</td>
                <td>{{ team.but_pour }}</td>
                <td>{{ team.but_contre }}</td>
                <td>{{ team.victoire }}</td>
                <td>{{ team.defaite }}</td>
                <td>{{ team.nul }}</td>
            </tr>


        {% endfor %}


    </table>

    {% else %}

        {% for team in poule.teams %}
            {{ team }}
        {% endfor %}

    {% endif %}

        {% include "admin/block/positions.html.twig" %}


        {% endfor %}




        {#<hr>#}
        {#<h4>Matchs</h4>#}
{#<hr >#}

        {#{% for groupe_array in groupes %}#}

                    {#{% set groupe = groupe_array["poule"] %}#}

            {#<h5>Matchs de {{ groupe }}</h5>#}
            {#<hr />#}

                {#{% include "admin/block/matchs.html.twig" %}#}
            {#<hr  class="mt-5" />#}
            {#{% endfor %}#}




        <div class="row mt-5">

            {% if is_granted("ROLE_ADMIN") %}
                <div class="col-4">
                    {% if not phase.finished() %}
                       <p class="alert alert-danger">impossible de générer les matchs de la poule, tous les matchs ne sont pas terminés</p>
                    {% elseif nbEgalite > 0 %}
                        <p class="alert alert-danger">impossible de générer les matchs de la poule des égalités existent</p>

                    {% else  %}
                    <a class="btn btn-secondary w-100 m-2"  href="{{ path("app_admin_category_phase_generate",{idCategory:category.id, idPhase:phase.id}) }}">Générer les matchs de la phase suivante</a>
                {% endif %}</div>

            {% if params["tournoi_en_cours"] != "oui" %}
                <div class="col-4"><a class="btn btn-danger w-100 m-2" href="{{ path("app_admin_category_phase_delete",{idCategory:category.id, idPhase:phase.id}) }}">Supprimer tous les matchs de la phase</a></div>
            {% endif %}

                {% if params["tournoi_en_cours"] != "oui" %} <div class="col-4"><a class="btn btn-primary w-100 m-2" href="{{ path("app_admin_update_phase",{idCategory:category.id, id:phase.id}) }}">Modifier la phase</a></div>
                <div class="col-4"><a class="btn btn-primary w-100 m-2" href="{{ path("app_admin_simulate_match",{idCategory:category.id, idPhase:phase.id}) }}">Simuler tous les matchs</a></div>{% endif %}
            {% endif %}


        </div>



    </div>
{% endblock %}

{% block secondNav %}
    {% include "admin/adminMenu.html.twig" %}
{% endblock %}